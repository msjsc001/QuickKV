# ✍️QuickKV 轻量级快捷输入补全工具
![PixPin_2025-07-21_13-26-17](https://github.com/user-attachments/assets/622041c6-21dd-45c8-9e43-628c4b6cab22)

**QuickKV是一款轻量、高效、零门槛、易迁移、高度可定制的中文联自动补全输快捷输入增强工具**。它能让您将所有常用的文本片段（如邮箱、代码、模板、常用回复等）保存在一个或多个简单的 Markdown 文件中，并通过全局热键 `Ctrl+Space` 在任何应用程序中即时搜索并粘贴它们，极大地提升您的输入效率。

<p align="center">
  <a href="https://github.com/msjsc001/QuickKV/releases/latest"><img src="https://img.shields.io/github/v/release/msjsc001/QuickKV"></a>
  <a href="https://github.com/msjsc001/QuickKV/commits/master"><img src="https://img.shields.io/github/last-commit/msjsc001/QuickKV"></a>
  <a href="https://github.com/msjsc001/QuickKV/releases"><img src="https://img.shields.io/github/downloads/msjsc001/QuickKV/total?label=Downloads&color=brightgreen"></a>
</p>

<img width="1169" height="1045" alt="PixPin_2025-07-19_11-57-58" src="https://github.com/user-attachments/assets/c63fb704-32e6-4d74-98d0-a508e156c0f9" />

![PixPin_2025-07-20_22-31-31](https://github.com/user-attachments/assets/9e9714b5-c619-431a-a2b3-9b784be9ef67)

![PixPin_2025-07-22_15-41-55](https://github.com/user-attachments/assets/a04e8887-5130-4696-ba15-b2b09fecb7bb)

![PixPin_2025-07-21_19-09-56](https://github.com/user-attachments/assets/8a85521a-a8d9-4288-9b00-b61229b5bb71)

![PixPin_2025-07-22_15-21-24](https://github.com/user-attachments/assets/4b084639-2006-4560-8c86-b89d177ffaca)

---

## 核心特性

*   **全局热键**: 在任何地方按下 `Ctrl + Space` 即可呼出搜索框。
*   **多词库管理**:
    *   支持同时加载多个 `.md` 词库文件。
    *   可在托盘菜单中动态添加、启用/禁用、移除词库。
    *   可快速打开词库文件所在的目录，方便编辑。
*   **剪贴板记忆**:
    *   可选功能，开启后可自动记录剪贴板的文本内容。
    *   在搜索框为空时优先显示剪贴板历史，方便快速粘贴。
    *   支持自定义记忆数量和一键清空历史。
*   **词条管理**:
    *   支持在程序内通过右键菜单直接**添加、编辑、删除**词条。
    *   支持多行词条（父子内容），用于管理复杂的模板和代码片段。
    *   独有的 ` ``不出现`` ` 语法，可在粘贴时忽略父级标题。
*   **智能搜索**:
    *   支持对父级词条进行关键词模糊搜索和多关键词筛选（空格分隔）。
    *   支持**拼音首字母搜索**，输入 `qd` 即可匹配“请定”。
*   **高度自定义**:
    *   支持**日间/夜间**双主题。
    *   可自由**调整窗口大小**和**设置字体大小**。
    *   支持**窗口置顶**（图钉功能）。
*   **稳定性保障**:
    *   **原生快捷键**: 使用 Windows 原生 API 注册全局热键，彻底告别因钩子不稳定导致的快捷键失效问题。
    *   可选的**间隔时间自动重启**功能，确保程序长时间稳定运行。
*   **轻量与高效**: 后台静默运行，占用极少系统资源，并通过文件热重载实现配置和词库的实时更新。

---

## 用户手册

### 1. 安装与配置

**步骤一：安装依赖**

本工具使用 Python 编写，需要您先安装 Python 环境（推荐 Python 3.8+）。然后，在终端中运行以下命令安装所需库：

```bash
pip install PySide6 pyperclip pypinyin
```

**步骤二：准备文件**

1.  将代码保存为 `quick_kv.py`。
2.  在 `quick_kv.py` 所在的目录下，创建一个名为 `词库.md` 的文件。如果文件不存在，程序首次启动时会自动为您创建示例。

**步骤三：编辑词库**

用任何文本编辑器打开 `.md` 词库文件。程序支持两种格式的词条：

**1. 单行词条**
每一行以 `- ` (减号 + 空格) 开头即可。
```markdown
- 我的个人邮箱是 my-email@example.com
- 公司地址：XX省XX市XX区XX路XX号
```

**2. 多行词条 (父子内容)**
以 `- ` 开头的行作为“父级”（用于搜索），其下方所有不以 `- ` 开头的行都会被视为“子内容”。

```markdown
- 这是一个父级
这是它的子内容第一行
  这也是子内容（支持缩进和空行）

- 这是一个模板标题 ``不出现``
  这是模板的第一行内容
  这是模板的第二行内容
```

*   **` ``不出现`` ` 语法**: 如果您希望在粘贴时只输出子内容，而忽略父级（例如模板的标题），只需在父级行末尾加上 ` ``不出现`` ` 即可。

### 2. 使用说明

1.  **启动程序**:
    在终端中，进入 `quick_kv.py` 文件所在的目录，然后运行：
    ```bash
    python quick_kv.py
    ```

2.  **呼出窗口**:
    在任何需要输入文本的地方，按下快捷键 `Ctrl + Space`。

3.  **搜索与选择**:
    *   在搜索框中输入关键词进行搜索。
    *   使用 `上/下` 方向键或鼠标选择结果。
    *   按下 `回车` 键或用鼠标**单击**词条完成选择。

4.  **管理程序**:
    在系统托盘区找到程序图标，**右键点击**可进行所有高级操作，包括：
    *   **启用/禁用快捷键**: 总开关。
    *   **间隔时间自动重启**: 设置程序自动重启以保持稳定。
    *   **词库选择**: 管理你的多个词库文件。
    *   **搜索选项**: 切换“多词搜索”和“拼音首字母匹配”。
    *   **剪贴板记忆**: 开启或关闭剪贴板历史功能。
    *   **UI设置**: 切换主题、调整字体大小。
    *   **退出**: 关闭程序。

---

## 更新日志

### V1.0.5.8 快捷键重构
*   **根本性修复**: 彻底重构了快捷键实现方式，弃用原有的 `keyboard` 库，改为使用 **Windows 原生 API (`RegisterHotKey`)** 进行全局热键注册。
    *   **解决了什么问题?** 解决了程序长时间运行后，因键盘钩子不稳定而导致的快捷键完全失效的核心问题。
    *   **带来了什么好处?**
        *   **极高的稳定性**: 新方案由操作系统直接调度，稳定可靠，不再需要“定时重建钩子”等临时性维护手段。
        *   **更高的效率**: 几乎零资源占用，仅在快捷键按下时才响应。
    *   **代码变更**: 所有与旧 `keyboard` 库相关的功能，包括“重建快捷键”菜单和定时器，均已被**彻底移除**，代码更精简、更健壮。

### V1.0.5.7 修复与优化
*   修复了在开启剪贴板记忆功能后，无法搜索到剪贴板历史内容的问题。
*   修复了对剪贴板历史条目右键时，缺失“添加到词库”选项的问题。
*   修复了搜索窗口被唤起时，输入光标没有自动聚焦到搜索框的问题。

### V1.0.5.6 添加词库时需要选择库
*   **功能增强**: 在输入框右键“添加到词库”时，如果存在多个词库，会弹出选择列表，让用户决定将新词条添加到哪个具体的 `.md` 文件中。
### V1.0.5.5 
*   **新功能：快速打开词库**
    *   在“词库选择”菜单中，为每个词库增加了一个“打开”按钮，可以快速在文件浏览器中定位到该词库文件，方便编辑。

### V1.0.5.4 
*   **新功能：增强稳定性**
    *   在系统托盘菜单中增加了“间隔时间自动重启”子菜单。
    *   用户可以启用/禁用此功能（默认关闭），并自由设定重启的间隔时间（默认3分钟）。
    *   提供“立即重启”选项，方便手动重启程序。
*   **修复**
    *   优化了重启逻辑，确保重启命令能被正确执行。

### V1.0.5.3
*   **新功能：剪贴板文字记忆**
    *   在系统托盘增加“剪贴板文字记忆”功能，默认关闭。
    *   用户可开启后，程序会自动记录剪贴板历史。在搜索框为空时，会优先展示剪贴板历史记录。
    *   支持自定义记忆条数（默认10条）和一键清空所有历史。
    *   剪贴板历史条目同样支持右键菜单，可将其“添加到词库”、进行“编辑”或“删除”。
    *   剪贴板历史被保存在独立的 `剪贴板词库.md` 文件中。

### V1.0.5.2
*   **新功能：多词库支持**
    *   现在可以在“词库选择”菜单中添加任意多个 `.md` 文件作为词库。
    *   每个词库都可以被独立启用或禁用，方便用户根据场景切换词库。
    *   支持从菜单中直接移除词库（不会删除本地文件）。
    *   如果词库文件在本地被删除，程序会自动将其从列表中移除。

### V1.0.5.1
*   **新功能：界面内词条管理**
    *   在搜索框和结果列表区域增加了右键上下文菜单。
    *   现在可以直接在输入框中输入内容后，右键选择“添加到词库”。
    *   可以直接右键点击结果列表中的词条，进行“编辑”或“删除”操作。
    *   编辑功能会弹出一个与主界面风格统一的文本编辑窗口。

### V1.0.4.1
*   **修复与优化**
    *   引入了自动和手动的快捷键钩子重建机制，以解决程序长时间运行后快捷键失效的问题。

---

## 开发者指南

### 1. 项目架构

*   **`MainController` (主控制器)**: 应用程序的大脑，负责协调各组件、注册全局热键、监控文件变化、管理系统托盘菜单等。
*   **`SearchPopup` (搜索弹窗UI)**: 负责所有图形界面，包括无边框窗口的构建、拖拽缩放的实现、主题样式的应用等。
*   **`WordManager` (词库管理器)**: 负责词库的读取、排序和搜索（包括文本、多词和拼音首字母）。
*   **`SettingsManager` (设置管理器)**: 负责 `config.ini` 配置文件的读写。
*   **`StyledItemDelegate` (样式代理)**: 负责列表项的自定义绘制，实现更精细的UI控制（如多行渲染和颜色区分）。

### 2. 核心技术点

*   **原生快捷键与线程安全**: 使用 `ctypes` 调用 Windows 原生 API (`RegisterHotKey`) 在一个独立的 `threading` 线程中监听全局热键。当热键被触发时，通过 PySide6 的**信号/槽机制**安全地通知主GUI线程执行相应操作，做到了响应迅速且线程安全。
*   **文件监控与防抖**: 使用 `QFileSystemWatcher` 监控文件变化，并结合 `QTimer` 实现“防抖”，避免文件在短时间内被多次保存时触发重复的重载操作。
*   **无边框窗口交互**: 通过重写 `mousePress/Move/ReleaseEvent` 事件实现窗口拖拽，并通过判断鼠标位置和 `_update_resize_cursor` 方法动态改变光标，实现各方向的窗口缩放。

### 3. 项目结构

```
.
├── quick_kv.py         # 主程序脚本
├── 词库.md             # 默认用户词库文件
├── 剪贴板词库.md       # 剪贴板历史记录文件
├── config.ini          # 配置文件
├── icon.png            # 应用程序图标
└── README.md           # 项目说明文档
```

### 4. 构建可执行文件 (Windows)

本项目使用 PyInstaller 进行打包。

1.  **安装 PyInstaller**:
    ```bash
    pip install pyinstaller
    ```

2.  **执行打包命令**:
    在项目根目录下，运行以下命令来创建一个独立的 `.exe` 文件：
    ```bash
    pyinstaller --noconsole --icon="icon.png" --add-data "icon.png;." quick_kv.py
    ```
    *   `--noconsole`: 运行时不显示命令行窗口。
    *   `--icon`: 为 `.exe` 文件和系统托盘指定图标。
    *   `--add-data`: 将图标资源打包。`词库.md` 和 `config.ini` 会在首次运行时自动生成，无需打包。

3.  **获取结果**:
    打包成功后，您可以在 `dist/quick_kv` 目录下找到生成的 `quick_kv.exe` 文件。
