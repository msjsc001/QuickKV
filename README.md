# ✍️QuickKV 轻量级快捷输入补全工具
<img width="1916" height="993" alt="PixPin_2025-07-23_16-21-34" src="https://github.com/user-attachments/assets/f59b0ef7-72f4-43e3-821f-ed4a7988b13e" />

<img width="1916" height="993" alt="PixPin_2025-07-23_16-20-48" src="https://github.com/user-attachments/assets/3756afbc-c0e7-47e9-82da-8fe73f23b5cf" />


**QuickKV是一款只专注于中文自动补全文本拓展的开源、轻量级、高效、零门槛、易迁移、轻度剪贴板记忆、高可定制化、纯净无任何商业目的快捷输入增强工具**。它能让您将所有常用的文本片段（如邮箱、代码、模板、常用回复等）保存在一个或多个简单的 Markdown 文件词库中（多词库可灵活勾选使用），通过全局热键 `Ctrl+Space` 在任何应用程序中即时搜索并粘贴它们（支持拼音首字母，空格多词），极大地提升您的输入效率。

(注：这是QuickKV词库用Markdown大纲管理的加强软感兴趣的可以看看： [KVTree](https://github.com/msjsc001/KVTree/blob/main/README.md))

<img width="1943" height="1016" alt="ZS1HDW8CTDSIW7SBS5@4TXT" src="https://github.com/user-attachments/assets/ffe1a9f7-2d82-4ff6-af29-586a9d066a0e" />

- 它与**自动补全类软件旗舰软件** FastKeys、PhraseExpander 不同的是，KV只专注于中文补全且支持中文超轻量级，没有其它更多的功能,比如输入字母后加一个特定按钮打开一个软件、网站之类，如果有需要这类功能**推荐可以 FastKeys 配合使用，KV这里就不重复造轮子了**，FastKeys也是款很不错的软件。PhraseExpander 是自动补全标杆级软件，功能相对繁杂，喜欢的也可以尝试。（不过就我个人而言，并不是太乐意去记忆几个字母+一个特定按钮激活的方式来打开软件，因为我自己有几百个软件这样根本不现实，也徒增认知负担，更喜欢图形化直观的图标，我个人更的是用OneCommander，做一个快捷启动的文件夹，文件夹里有分类一键就能展开各种复杂分类打开程序，非常稳定高效，几乎无迁移问题）
- 它与**剪贴板旗舰类软件** Ditto 的差异是更便捷，**KV也轻度的支持剪贴板记忆**，Ditto 也能将文本图片等分组固定，后期通过快捷搜索找到内容贴入，不过你可能要多按几次键盘按钮，**它更多是侧重在功能强大的剪贴板管理**，而非补全，有很多细微的差异。总的来说它也是一种不错的方式，推荐喜欢的朋友也可以试试，也可以组合使用，由于它的剪贴板功能更强大，**你也可以选择关闭KV的剪贴板记忆使用它的剪贴板，使用KV的补全输入**，这样两者的长处都取，总之选择自己最喜欢的方式（我个人更用KV的简单方式的剪贴板已经足够）。
- 它与**通常输入法自定义短语**非常类同，的差异是搜索、展现、管理逻辑不一样。输入法的更多是**联想查找**，而KV是**匹配查找**，搜索上KV是聚焦不是发散。展现上KV是任意调节窗口的列表列表式，更利于对比。管理上多md词库（这和txt文本就只是后缀不同），非常易于管理和迁移。不过如果你只有很少的词需要进行拓展，其实输入法自带的短语也就够用了，无须用到KV这些软件，没有需求就不用创造需求，凭空增加自己使用电脑的的成本，但如果你有文本拓展需求时使用KV或上述提到的软件，那就是效率增益。
- 它与**脚本语言自动化软件自动补全软件 AutoHotkey、Espanso 差异是**，它是定制好的，是基于 Python 的， Python 延展性可库支持是很强大的，且现在AI编程对Python的支持是非常好的，很多简单的需求和改进一句话基本就能解决需求，换句话说对小白而言只要环境搭建好开发效率也会大大高于 Quicker 这类积木软件，你都不用去搭积木了。
- 它与**工具库插件库类软件 Flow Launcher、Quicker**这类庞大快的指令型软件差异，也是很明显的，你不需要去写一个插件，它已经是一个完成体，当然你要喜欢自己用代码或搭积木再定制，那么上这两也是可以的。

**Anyhow 按自己所需所喜欢的来就是最适合，就是最好的！**

<p align="center">
  <a href="https://github.com/msjsc001/QuickKV/releases/latest"><img src="https://img.shields.io/github/v/release/msjsc001/QuickKV"></a>
  <a href="https://github.com/msjsc001/QuickKV/commits/master"><img src="https://img.shields.io/github/last-commit/msjsc001/QuickKV"></a>
  <a href="https://github.com/msjsc001/QuickKV/releases"><img src="https://img.shields.io/github/downloads/msjsc001/QuickKV/total?label=Downloads&color=brightgreen"></a>
</p>

<img width="1169" height="1045" alt="PixPin_2025-07-19_11-57-58" src="https://github.com/user-attachments/assets/c63fb704-32e6-4d74-98d0-a508e156c0f9" />

![PixPin_2025-07-20_22-31-31](https://github.com/user-attachments/assets/9e9714b5-c619-431a-a2b3-9b784be9ef67)
注：方式2（;后弹窗搜索）因为不实用不直观 在1.0.3已经取消

![PixPin_2025-07-22_15-41-55](https://github.com/user-attachments/assets/a04e8887-5130-4696-ba15-b2b09fecb7bb)

![PixPin_2025-07-21_19-09-56](https://github.com/user-attachments/assets/8a85521a-a8d9-4288-9b00-b61229b5bb71)

![PixPin_2025-07-22_15-21-24](https://github.com/user-attachments/assets/4b084639-2006-4560-8c86-b89d177ffaca)

---

## 核心特性

*   **全局热键**: 在任何地方按下 `Ctrl + Space` 即可呼出搜索框。
*   **多词库管理**:
    *   支持同时加载多个 `.md` 词库文件。
    *   可在托盘菜单中动态添加、启用/禁用、移除词库。
    *   可快速打开词库文件所在的目录，方便编辑。
*   **剪贴板记忆**:
    *   可选功能，开启后可自动记录剪贴板的文本内容。
    *   在搜索框为空时优先显示剪贴板历史，方便快速粘贴。
    *   支持自定义记忆数量和一键清空历史。
*   **词条管理**:
    *   支持在程序内通过右键菜单直接**添加、编辑、删除**词条。
    *   支持多行词条（父子内容），用于管理复杂的模板和代码片段。
    *   独有的 ` ``不出现`` ` 语法，可在粘贴时忽略父级标题。
*   **智能搜索**:
    *   支持对父级词条进行关键词模糊搜索和多关键词筛选（空格分隔）。
    *   支持**拼音首字母搜索**，输入 `qd` 即可匹配“请定”。
*   **高度自定义**:
    *   支持**日间/夜间**双主题。
    *   可自由**调整窗口大小**和**设置字体大小**。
    *   支持**窗口置顶**（图钉功能）。
*   **稳定性保障**:
    *   **原生快捷键**: 使用 Windows 原生 API 注册全局热键，彻底告别因钩子不稳定导致的快捷键失效问题。
    *   可选的**间隔时间自动重启**功能，确保程序长时间稳定运行。
*   **轻量与高效**: 后台静默运行，占用极少系统资源，并通过文件热重载实现配置和词库的实时更新。

---
<img width="1440" height="1025" alt="e00bf0ba05239340502f3da51849365" src="https://github.com/user-attachments/assets/d656f6bf-06a9-4ecd-99ee-1c392f68d91a" />

## 用户手册

### 1. 安装与配置

**步骤一：安装依赖**

（如果使用exe程序在 https://github.com/msjsc001/QuickKV/releases 下载即可，无须使用 Python 配置，可跳过步骤一二三）

本工具使用 Python 编写，需要您先安装 Python 环境（推荐 Python 3.8+）。然后，在终端中运行以下命令安装所需库：

```bash
pip install PySide6 pyperclip pypinyin
```

**步骤二：准备文件**

1.  将代码保存为 `quick_kv.py`。
2.  在 `quick_kv.py` 所在的目录下，创建一个名为 `词库.md` 的文件。如果文件不存在，程序首次启动时会自动为您创建示例。

**步骤三：编辑词库**

用任何文本编辑器打开 `.md` 词库文件。程序支持两种格式的词条：

**1. 单行词条**
每一行以 `- ` (减号 + 空格) 开头即可。
```markdown
- 我的个人邮箱是 my-email@example.com
- 公司地址：XX省XX市XX区XX路XX号
```

**2. 多行词条 (父子内容)**
以 `- ` 开头的行作为“父级”（用于搜索），其下方所有不以 `- ` 开头的行都会被视为“子内容”。

```markdown
- 这是一个父级
这是它的子内容第一行
  这也是子内容（支持缩进和空行）

- 这是一个模板标题 ``不出现``
  这是模板的第一行内容
  这是模板的第二行内容
```

*   **` ``不出现`` ` 语法**: 如果您希望在粘贴时只输出子内容，而忽略父级（例如模板的标题），只需在父级行末尾加上 ` ``不出现`` ` 即可。

### 2. 使用说明

1.  **启动程序**:

    在终端中，进入 `quick_kv.py` 文件所在的目录，然后运行：
    ```bash
    python quick_kv.py
    ```

2.  **呼出窗口**:
    在任何需要输入文本的地方，按下快捷键 `Ctrl + Space`。

3.  **搜索与选择**:
    *   在搜索框中输入关键词进行搜索。
    *   使用 `上/下` 方向键或鼠标选择结果。
    *   按下 `回车` 键或用鼠标**单击**词条完成选择。

4.  **管理程序**:
    在系统托盘区找到程序图标，**右键点击**可进行所有高级操作，包括：
    *   **启用/禁用快捷键**: 总开关。
    *   **间隔时间自动重启**: 设置程序自动重启以保持稳定。
    *   **词库选择**: 管理你的多个词库文件。
    *   **搜索选项**: 切换“多词搜索”和“拼音首字母匹配”。
    *   **剪贴板记忆**: 开启或关闭剪贴板历史功能。
    *   **UI设置**: 切换主题、调整字体大小。
    *   **退出**: 关闭程序。

---

## 开发者指南

### 1. 项目架构

*   **`MainController` (主控制器)**: 应用程序的大脑，负责协调各组件、注册全局热键、监控文件变化、管理系统托盘菜单等。
*   **`SearchPopup` (搜索弹窗UI)**: 负责所有图形界面，包括无边框窗口的构建、拖拽缩放的实现、主题样式的应用等。
*   **`WordManager` (词库管理器)**: 负责词库的读取、排序和搜索（包括文本、多词和拼音首字母）。
*   **`SettingsManager` (设置管理器)**: 负责 `config.ini` 配置文件的读写。
*   **`StyledItemDelegate` (样式代理)**: 负责列表项的自定义绘制，实现更精细的UI控制（如多行渲染和颜色区分）。

### 2. 核心技术点

*   **原生快捷键与线程安全**: 使用 `ctypes` 调用 Windows 原生 API (`RegisterHotKey`) 在一个独立的 `threading` 线程中监听全局热键。当热键被触发时，通过 PySide6 的**信号/槽机制**安全地通知主GUI线程执行相应操作，做到了响应迅速且线程安全。
*   **文件监控与防抖**: 使用 `QFileSystemWatcher` 监控文件变化，并结合 `QTimer` 实现“防抖”，避免文件在短时间内被多次保存时触发重复的重载操作。
*   **无边框窗口交互**: 通过重写 `mousePress/Move/ReleaseEvent` 事件实现窗口拖拽，并通过判断鼠标位置和 `_update_resize_cursor` 方法动态改变光标，实现各方向的窗口缩放。

### 3. 项目结构

```
.
├── quick_kv.py         # 主程序脚本
├── 词库.md             # 默认用户词库文件
├── 剪贴板词库.md       # 剪贴板历史记录文件
├── config.ini          # 配置文件
├── icon.png            # 应用程序图标
└── README.md           # 项目说明文档
```

### 4. 构建可执行文件 (Windows)

本项目使用 PyInstaller 进行打包。

1.  **安装 PyInstaller**:
    ```bash
    pip install pyinstaller
    ```

2.  **执行打包命令**:
    在项目根目录下，运行以下命令来创建一个独立的 `.exe` 文件：
    ```bash
    pyinstaller --noconsole --icon="icon.png" --add-data "icon.png;." quick_kv.py
    ```
    *   `--noconsole`: 运行时不显示命令行窗口。
    *   `--icon`: 为 `.exe` 文件和系统托盘指定图标。
    *   `--add-data`: 将图标资源打包。`词库.md` 和 `config.ini` 会在首次运行时自动生成，无需打包。

3.  **获取结果**:
    打包成功后，您可以在 `dist/quick_kv` 目录下找到生成的 `quick_kv.exe` 文件。

---

## 更新日志
### 1.0.5.17 修复：剪贴板记忆满后无法更新问题

### 1.0.5.16 优化UI：更柔和的调色
*  6让选中颜色不是深蓝色

### V1.0.5.15 减法：去除意义不大的功能界面图钉、优化UI
*  减法：取消图钉功能
*  UI：界面菜单加入分割线，使内容更易区分、加入版本号在界面左上角显示
### V1.0.5.14 加强：长词条删除时界面超出显示器外，加入滚动条。

### V1.0.5.13 加强：剪贴板文字记忆 内容被移动到新词库时 去除“剪贴板词库.md”

### V1.0.5.12 修复：启用剪贴板记忆时软件复制软内容会出现空行
*  加强：软件输出默认使用ctrl+v，用户可选用ctrl+shift+v、ctrl+v、模拟打字

### V1.0.5.11 修复：启用剪贴板记忆时软件复制软内容会出现空行
*  现在有一个新的问题也就是软件在我使用"剪贴板记忆"的时候复制“带有软换行的内容”或多行内容时会自动出现一些空行，使用统一 `\n` vs `\r\n`的方式修复

### V1.0.5.10 修复：图钉模式下，内容未贴好就转回程序
*  让 PowerShell 采用“shift+ctrl+v”的方式来输入内容
*  图钉模式时让焦点不回到界面，界面只做一个“调色板”。

### V1.0.5.9 修复：无法贴出内容、取消窗口在屏幕边缘上下翻
*   **修复无法贴出内容**
    *   `ctypes`库能稳定的识别快捷键，但不能粘贴
        *   **通过 PowerShell 调用 .NET 的 `SendKeys` API 来执行粘贴**
*   **取消窗口在屏幕边缘上下翻**

### V1.0.5.8 修复：快捷键重构
*   **根本性修复**: 彻底重构了快捷键实现方式，弃用原有的 `keyboard` 库，改为使用 **Windows 原生 API (`RegisterHotKey`)** 进行全局热键注册。
    *   **解决了什么问题?** 解决了程序长时间运行后，因键盘钩子不稳定而导致的快捷键完全失效的核心问题。
    *   **带来了什么好处?**
        *   **极高的稳定性**: 新方案由操作系统直接调度，稳定可靠，不再需要“定时重建钩子”等临时性维护手段。
        *   **更高的效率**: 几乎零资源占用，仅在快捷键按下时才响应。
    *   **代码变更**: 所有与旧 `keyboard` 库相关的功能，包括“重建快捷键”菜单和定时器，均已被**彻底移除**，代码更精简、更健壮。

### V1.0.5.7 修复：三个问题
*   修复了在开启剪贴板记忆功能后，无法搜索到剪贴板历史内容的问题。
*   修复了对剪贴板历史条目右键时，缺失“添加到词库”选项的问题。
*   修复了搜索窗口被唤起时，输入光标没有自动聚焦到搜索框的问题。

### V1.0.5.6 添加词库时需要选择库
*   **功能增强**: 在输入框右键“添加到词库”时，如果存在多个词库，会弹出选择列表，让用户决定将新词条添加到哪个具体的 `.md` 文件中。

### V1.0.5.5 
*   **新功能：快速打开词库**
    *   在“词库选择”菜单中，为每个词库增加了一个“打开”按钮，可以快速在文件浏览器中定位到该词库文件，方便编辑。

### V1.0.5.4 
*   **新功能：增强稳定性**
    *   在系统托盘菜单中增加了“间隔时间自动重启”子菜单。
    *   用户可以启用/禁用此功能（默认关闭），并自由设定重启的间隔时间（默认3分钟）。
    *   提供“立即重启”选项，方便手动重启程序。
*   **修复**
    *   优化了重启逻辑，确保重启命令能被正确执行。

### V1.0.5.3
*   **新功能：剪贴板文字记忆**
    *   在系统托盘增加“剪贴板文字记忆”功能，默认关闭。
    *   用户可开启后，程序会自动记录剪贴板历史。在搜索框为空时，会优先展示剪贴板历史记录。
    *   支持自定义记忆条数（默认10条）和一键清空所有历史。
    *   剪贴板历史条目同样支持右键菜单，可将其“添加到词库”、进行“编辑”或“删除”。
    *   剪贴板历史被保存在独立的 `剪贴板词库.md` 文件中。

### V1.0.5.2
*   **新功能：多词库支持**
    *   现在可以在“词库选择”菜单中添加任意多个 `.md` 文件作为词库。
    *   每个词库都可以被独立启用或禁用，方便用户根据场景切换词库。
    *   支持从菜单中直接移除词库（不会删除本地文件）。
    *   如果词库文件在本地被删除，程序会自动将其从列表中移除。

### V1.0.5.1
*   **新功能：界面内词条管理**
    *   在搜索框和结果列表区域增加了右键上下文菜单。
    *   现在可以直接在输入框中输入内容后，右键选择“添加到词库”。
    *   可以直接右键点击结果列表中的词条，进行“编辑”或“删除”操作。
    *   编辑功能会弹出一个与主界面风格统一的文本编辑窗口。

### V1.0.4.1
*   **修复与优化**
    *   引入了自动和手动的快捷键钩子重建机制，以解决程序长时间运行后快捷键失效的问题。

### V1.0.3
*   1、取消"；"复制内容快捷键启动界面功能，因为会导致失焦，且实用意义不大
*   2、系统托盘内添加了总开关（快捷键开关）

### V1.0.2 
*   1、利用利用每个字的拼音首字母，进行搜索，的功能
    *   比如在输入框输入 拼音字母 “qd”就能找到“请定”之类的字，输入的越多匹配的也越精确（按理匹配的内容就越少），这个功能请给一个系统托盘的勾选框叫"拼音首字母匹配"，默认开启。"
*   2、"；"复制内容快捷键启动界面
    *   如果用户点击"；"键（有时也是"；"），就使用 ctrl+shift+左键 的方法复制文本，复制后需要1次删除键去除选择的文本，因为文本后边会转移到输入框，而后自动开启软件界面填入复制的文本。这个功能请给一个系统托盘的勾选框叫"；键复制查询"默认开启。
    *   这个功能一般建议配合拼音首字母方法用。

## V1.0.1
*   排序按字母整理（词库和搜索）
    *   词库和搜索结果内自动按前缀（名字）排序整理（中文会识别拼音首字母排序）
    *   避免了大量自加词后，词库和搜索可读性差的问题，
    *   词库排序整理 在软件关闭时检测到词库文件有变化后才会进行（用内容哈希校验），且**软件被关闭后**，这样避免和用户输入词库冲突，也为性能考虑。

## V1.0.0
*   新功能
    *   版本提示
            *   系统托盘菜单，加入版本标识 QuickKV_V1.0.0
        *   搜索：打空格多词包含搜索
            *   也叫多关键词搜索，逻辑搜索 (AND Search)
    *   UI修改
        *   托盘菜单和系统界面UI风格统一 1150
    *   修复bug
        *   窗口 `ctrl+空格` 前置时无法切换日夜模式
        *   修复无法窗口拖拽放大缩小
    *   构建
        *   构建了win1.0版
